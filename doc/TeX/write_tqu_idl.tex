% -*- LaTeX -*-

% PLEASE USE THIS FILE AS A TEMPLATE FOR THE DOCUMENTATION OF YOUR OWN
% FACILITIES: IN PARTICULAR, IT IS IMPORTANT TO NOTE COMMENTS MADE IN
% THE TEXT AND TO FOLLOW THIS ORDERING. THE FORMAT FOLLOWS ONE USED BY
% THE COBE-DMR PROJECT.	
% A.J. Banday, April 1999.

\renewcommand{\facname}{{write\_tqu }}
\renewcommand{\FACNAME}{{WRITE\_TQU }}
\sloppy

\title{\healpix IDL Facility User Guidelines}
\docid{write\_tqu} \section[write\_tqu]{ }
\label{idl:write_tqu}
\docrv{Version 1.2}
\author{Eric Hivon}
\abstract{This document describes the \healpix facility \thedocid.}

\begin{facility}
{This IDL facility writes a temperature+polarization Healpix map (T,Q,U) into a
binary table FITS file, 
with optionally the error (dT,dQ,dU) and correlation (dQU, dTU, dTQ)
in separate extensions
}
{src/idl/fits/write\_tqu.pro}
\end{facility}

\begin{IDLformat}
{\FACNAME, \mylink{idl:write_tqu:File}{File}%
, \mylink{idl:write_tqu:TQU}{TQU}%
, [\mylink{idl:write_tqu:Coordsys}{Coordsys=}%
, \mylink{idl:write_tqu:Nested}{Nested=}%
, \mylink{idl:write_tqu:Ring}{Ring=}%
, \mylink{idl:write_tqu:Ordering}{Ordering=}%
, \mylink{idl:write_tqu:Error}{Error=}%
, \mylink{idl:write_tqu:Extension}{Extension=}%
, \mylink{idl:write_tqu:Help}{Help=}%
, \mylink{idl:write_tqu:Hdr}{Hdr=}%
, \mylink{idl:write_tqu:Xhdr}{Xhdr=}%
, \mylink{idl:write_tqu:Units}{Units=}%
, \mylink{idl:write_tqu:Help}{Help=}%
]}
\end{IDLformat}

\begin{qualifiers}
  \begin{qulist}{} %%%% NOTE the ``extra'' brace here %%%%
 	\item[{File}] \mytarget{idl:write_tqu:File}
          name of a FITS file in which the maps are to be written

   \item[{TQU}] \mytarget{idl:write_tqu:TQU} array of Healpix maps of size ($N_{\rm pix}$,3,{\tt n\_ext}) where $N_{\rm pix}$ is the total
   number of Healpix pixels on the sky, and {\tt n\_ext} $\le$ 3.\\
     Three maps are written in each extension of the FITS file : \\
      -the temperature+polarization Stokes parameters maps (T,Q,U) in
   extension 0 \\
      -the error maps (dT,dQ,dU) (if {\tt n\_ext} $\ge$ 2) in extension 1 \\
      -the correlation maps (dQU, dTU, dTQ) (if {\tt n\_ext} = 3) in extension 2
\\
     it is also possible to write 3 maps directly in a given
     extension (provided the preceding extension, if any, is already
     filled in)
     by setting {\tt Extension} to the extension number in which to write
     (0 based) and if {\tt n\_ext} + {\tt Extension} $\le$ 3

       \item[{Coordsys=}] \mytarget{idl:write_tqu:Coordsys}
		  (optional), \\
		if set to either 'C', 'E' or 'G',  specifies that the
		Healpix coordinate system is respectively Celestial=equatorial,
		  Ecliptic or Galactic.
		(The relevant keyword is then added/updated in the extension
		  header, but the map is NOT rotated)

	\item[{Error=}] \mytarget{idl:write_tqu:Error}
		(optional output), \\
		will take value 1 if file can not be written


       \item[{Extension=}]\mytarget{idl:write_tqu:Extension}
		(optional), \\
	extension unit a which to put the data (0 based). The physical
		interpretation of the maps is determined by the
		extension in which they are written\\
	\seealso TQU

       \item[{Hdr=}]\mytarget{idl:write_tqu:Hdr}
		  (optional), \\
		string variable containing on input  the information to be added
		  to the primary header. (If already present, FITS reserved
		  keywords will be automatically updated).

	\item[{Ordering=}] \mytarget{idl:write_tqu:Ordering}
		  (optional), \\
		if set to either 'ring' or 'nested' (case un-sensitive),
		  specifies that the map is respectively in RING or NESTED
		  ordering scheme\\
		\seealso Nested and Ring

	\item[{Units=}] \mytarget{idl:write_tqu:Units}
		(optional), \\
		string describing the physical units of the data set

       \item[{Xhdr=}] \mytarget{idl:write_tqu:Xhdr}
		  (optional), \\
		string variable containing on input  the information to be added
		  to the extension headerx. (If already present, FITS reserved
		  keywords will be automatically updated). It will be
		    repeated in each extension, except for TTYPE* and EXTNAME which
		    are generated by the routine and depend on the extension

  \end{qulist}
\end{qualifiers}

\begin{keywords}
  \begin{kwlist}{} %%% extra brace
	\item[{Help}]  \mytarget{idl:write_tqu:Help} if set, an extensive help is displayed and no
	file is written
	\item[{Nested}]  \mytarget{idl:write_tqu:Nested} if set, specifies that the map is in the NESTED ordering
	scheme\\
	\seealso Ordering and Ring 
	\item[{Ring}]  \mytarget{idl:write_tqu:Ring} if set, specifies that the map is in the RING ordering
	scheme\\
	\seealso Ordering and Nested
   \end{kwlist}
\end{keywords}

\begin{codedescription}
{\thedocid{} writes out Stokes parameters (T,Q,U) maps for the whole
sky into a FITS file. It is also possible to write the error per pixel for each
map and the correlation between fields, as subsequent extensions of the same FITS
file (see qualifiers above). Therefore the file may have up to three extensions with three
maps in each. Extensions can be written together or one by one (in
their physical order) using the Extension option}
\end{codedescription}



\begin{related}
  \begin{sulist}{} %%%% NOTE the ``extra'' brace here %%%%
  \item[idl] version \idlversion or more is necessary to run \thedocid
  \item[\htmlref{read\_tqu}{idl:read_tqu}] This \healpix IDL facility can be used to read in maps
  written by \thedocid.
  \item[\htmlref{read\_fits\_s}{idl:read_fits_s}] This \healpix IDL facility can be used to read
  into an IDL structure maps written by \thedocid.
  \item[sxaddpar] This IDL routine (included in \healpix package) can be used to update
  or add FITS keywords to the header(s) HDR or XHDR
\input{item_write_fits_idl}
  \end{sulist}
\end{related}


\begin{example}
{
\begin{tabular}{l} %%%% use this tabular format %%%%
npix = \htmlref{nside2npix}{idl:nside2npix}(64) \\
TQU = randomn(seed,npix,3) \\
write\_tqu,  'map\_polarization.fits', TQU, coord='G', /ring\\
\end{tabular}
}
{
The array TQU is defined to contain a fictitious polarisation map, with
the 3 Stokes parameters T, Q and U. The map is assumed to be in
Galactic coordinates, with a RING ordering of the pixels and $\nside=64$.
\thedocid{} writes out the contents of TQU into the extension 
of the FITS file 'map\_polarization.fits'.
}
\end{example}

